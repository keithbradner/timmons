<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Darkroom - Develop Like Dever</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Critical inline styles to prevent flash of unstyled content */
        html, body {
            margin: 0;
            padding: 0;
            background: #050505;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }
        #loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .loading-text {
            font-family: 'Roboto Mono', monospace;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.9rem;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        /* Hide content until CSS loads */
        #ui-layer, .overlay, .grain, .global-back-btn {
            visibility: hidden;
        }
        body.loaded #ui-layer,
        body.loaded .overlay,
        body.loaded .grain,
        body.loaded .global-back-btn {
            visibility: visible;
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <span class="loading-text">Entering Darkroom...</span>
    </div>

    <div id="canvas-container"></div>
    <div class="overlay"></div>
    <div class="grain"></div>

    <a href="/" class="global-back-btn global-back-btn-top">&larr; Back to Gallery</a>
    <a href="/" class="global-back-btn global-back-btn-bottom">&larr; Back to Gallery</a>

    <div id="ui-layer">

        <div class="hud-top">
            <div id="mode-indicator" class="status-text">DARKROOM EXPERIENCE</div>
        </div>

        <!-- Intro Panel -->
        <div id="panel-intro" class="panel">
            <h1>Welcome to the Darkroom</h1>
            <p>In the 1930s most camera films of the period were <strong>panchromatic</strong>. That means they needed total darkness while developing. That made it hard to get photos just right.</p>
            <p>Photographer Dever Timmons brought a technique back from Germany that let him be more exact. Instead of guessing when photos were ready, he used a special chemical called <strong>Pinakryptol Green</strong> to be able to look at them while they developed.</p>
            <p>We'll leave a bit of light on so you can see what's happening, but remember, real photographers developed in the dark!</p>
            <button onclick="startGame()">Enter The Darkroom</button>
        </div>

        <!-- Phase 1 Intro -->
        <div id="panel-phase1" class="panel hidden">
            <h1>Round 1: The Timer Method</h1>
            <p>First, let's try it the standard way. Set a timer, dunk all 5 photos, and hope for the best.</p>
            <p>You won't be able to control anything. Let's see what happens!</p>
            <button onclick="preparePhase1()">Got it</button>
        </div>

        <!-- Action Bar (Shared) -->
        <div id="action-bar" class="hidden">
            <!-- Phase 1 Buttons -->
            <button id="p1-drop-btn" class="action-btn" onclick="triggerPhase1Action()">DROP IN PHOTOS</button>

            <!-- Phase 2 Buttons -->
            <button id="p2-start-btn" class="action-btn hidden" onclick="triggerP2Start()">START</button>
            <button id="p2-inspect-btn" class="action-btn btn-inspect hidden" onclick="triggerP2Inspect()">PEEK AT IT</button>

            <button id="p2-resume-btn" class="action-btn btn-resume hidden" onclick="triggerP2Resume()">KEEP DEVELOPING</button>
            <button id="p2-finish-btn" class="action-btn btn-finish hidden" onclick="triggerP2Finish()">LOOKS GOOD!</button>
        </div>

        <!-- Phase 1 Results -->
        <div id="panel-result1" class="panel hidden">
            <h1>Hmm, Not Great...</h1>
            <div class="film-review-text">
                <p>See the problem? Every photo got the same time, but they weren't all the same:<br><br>
                &bull; Some are <strong>too light</strong> (faded and ghostly)<br>
                &bull; Some are <strong>too dark</strong> (muddy and hard to see)<br>
                &bull; Only a few look right</p>
            </div>
            <p>Now let's try <strong>Timmons' way</strong> and actually check how they're developing!</p>
            <button onclick="setupPhase2()">Try the Timmons Method</button>
        </div>

        <!-- Phase 2 Intro -->
        <div id="panel-phase2" class="panel hidden">
            <h1>Round 2: The Timmons Method</h1>
            <p>This time, you're in control. We'll develop each photo one at a time.</p>
            <p><strong>Here's how it works:</strong><br>
            1. The photo goes into a special bath first (so dim green light won't ruin it)<br>
            2. Then into the developer to bring out the picture<br>
            3. <strong>Peek at it</strong> under a dim green light to check progress<br>
            4. When it looks right, pull it out!</p>
            <button onclick="startPhase2()">Let's Do It</button>
        </div>

        <!-- Final Results -->
        <div id="panel-final" class="panel hidden">
            <h1>Nice Work!</h1>
            <p>By watching each photo develop, you saved shots that would have been ruined the old way.</p>
            <div class="film-review-text">
                 <div class="stat-row"><span class="stat-label">Photos Developed</span> <span class="stat-val">3</span></div>
                 <div class="stat-row"><span class="stat-label">Method</span> <span class="stat-val">Timmons Inspection</span></div>
                 <div class="stat-row"><span class="stat-label">Your Score</span> <span class="stat-val" id="final-score-val">0%</span></div>
                 <div id="verdict-text"></div>
            </div>
            <br>
            <a href="/" class="result-btn">Back to Gallery</a>
        </div>

    </div>

    <script type="module">
        import '/src/main.js'
        import { setupInactivityTimer } from '/src/inactivity.js'

        setupInactivityTimer(() => {
            window.location.href = '/'
        })
    </script>
</body>
</html>
